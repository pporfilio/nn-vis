<html>
<head>

    <title>NN Vis</title>

    <script>
        function start() {
            load_json();
        }

        function load_json() {
            // From https://stackoverflow.com/questions/14388452/how-do-i-load-a-json-object-from-a-file-with-ajax
            function fetchJSONFile(path, callback) {
                var httpRequest = new XMLHttpRequest();
                httpRequest.onreadystatechange = function() {
                    console.log("httpRequest.readyState: " + httpRequest.readyState);
                    console.log("httpRequest.status: " + httpRequest.status);
                    if (httpRequest.readyState === 4) {
                        if (httpRequest.status === 200) {
                            var data = JSON.parse(httpRequest.responseText);
                            if (callback) callback(data);
                        }
                    }
                };
                httpRequest.open('GET', path);
                httpRequest.send(); 
            }

            // This requests the file and executes a callback with the parsed result once
            //   it is available
            fetchJSONFile('https://s3.amazonaws.com/pporfilio/nn/test_json.json', 
                function(data){
                    populate(data)
                }
            );
        }

        function populate(data) {
            var selectLayerEl = document.getElementById("selectLayer"); 
            var selectNodeEl = document.getElementById("selectNode");

            selectLayerEl.addEventListener("change", function() {
                onSelectLayerChanged(data, this, selectNodeEl);
            });

            selectNodeEl.addEventListener("change", function() {
                onSelectNodeChanged(data, this);
            });

            for(var i = 0; i < data.layers.length; ++i) {
                var optionEl = document.createElement("option");
                optionEl.textContent = "layer " + i + " (" + data.layers[i] + " nodes)";
                optionEl.value = data.layers[i];
                selectLayerEl.appendChild(optionEl);
            }

            // Doesn't seem to get a changed callback after going from 0 to more than 0 options.
            onSelectLayerChanged(data, selectLayerEl, selectNodeEl);
        }


        function onSelectLayerChanged(data, selectLayerEl, selectNodeEl) {
            console.log("got selected index: " + selectLayerEl.selectedIndex);
            for (var i = selectNodeEl.options.length - 1; i >= 0; --i) {
                selectNodeEl.remove(i);
            }
            for (var i = 0; i < selectLayerEl.value; ++i) {
                var optionEl = document.createElement("option");
                optionEl.textContent = "Node " + i;
                optionEl.value = i;
                selectNodeEl.appendChild(optionEl);
            }
        }

        function onSelectNodeChanged(data, selectNodeEl) {
                console.log("got selected node: " + selectNodeEl.selectedIndex);
        }

    </script>
</head>

<body onload="start()">
    Select a Layer: <select id="selectLayer"></select>
    <br />
    Select a Node: <select id="selectNode"></select>
</body>
</html>
